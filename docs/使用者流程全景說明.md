# 使用者流程全景說明（含階段性策略）

## 流程總覽：從使用者上傳到風險分析回傳

### ✅ 步驟一：使用者上傳合約文件

* 支援 PDF 或純文字格式。
* 系統會以 OCR（若為 PDF）與文字清洗方式抽出條文全文。

---

### ✅ 步驟二：條文切分與語言判斷

* 條文會被切成段落，每段視為初步的條文單位。
* **中文條文**：以兩個以上換行符號切成段落作為主要依據，避免切得過碎。
* **英文條文**：以句號、問號、驚嘆號斷句，並納入 `a. b. c.` 這類列點補強。
* 語言判斷會在切句前先自動偵測條文語系。

---

### ✅ 步驟三：逐句風險分析

* 條文送入 `analyze_clause(clause, lang)` 分析函式。

* 其內部會根據語言呼叫 GPT，並依據內建 few-shot 範例學習分類：

  * "一般資訊"：常見說明性、標準合約義務
  * "須注意"：具不對等義務、模糊授權、可能產生糾紛之條文

* **注意：不會參考黑白名單判斷，只依賴 GPT 回傳。**

---

### ✅ 步驟四：儲存與回傳分析結果

* 每條分析後會產出：條文原文、風險等級、風險類型、標註理由。
* 結果儲存於 `outputs/full_agreement_analysis_debug.json`，供除錯與 UI 呈現。

---

### 🔍 測試用途補充：黑白名單

* `data/risk_examples.json`（高風險測資）與 `data/whitelist_examples.json`（一般資訊測資）僅作為測試使用。
* 執行 `test_risk_cases_runner_dual.py` 可比對實際分類與預期結果是否一致。
* 不會影響 GPT 真實判斷流程。

---

## 🔄 階段性策略：輸入方式擴充規劃

### ✅ 第一階段（MVP）：主打 Chrome Extension

* 使用者在網站看到「我同意」視窗時，可點擊擴充工具分析頁面條款內容。
* 擴充工具自動擷取頁面內文字，送入後端分析模組。
* 結果即時顯示風險分類與理由，無需複製貼上。

### ✅ 第二階段：加入 Word / 圖片檔上傳支援

* 支援 Word 檔（.docx）：使用 `python-docx` 擷取文字
* 支援圖片 OCR（JPG/PNG）：整合 Tesseract OCR 擷取條文後分析
* 建立前處理模組，清洗不規則格式與欄位內容

### ✅ 第三階段：開放 API 串接企業應用

* 對接合約管理系統、企業審閱平台等
* 提供 REST API，讓第三方系統傳送條文，自動獲得風險判斷
* 分析結果回傳 JSON，供整合前端顯示或記錄

---

此階段性策略將有助於兼顧輕量應用與企業擴展，實現彈性又可成長的風險分析工具。
