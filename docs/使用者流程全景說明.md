## 使用者流程全景說明

### 📍 起點：使用者遇到條款（例：註冊條款、APP 授權協議）

1. 使用者將條文內容複製貼上，或上傳一份完整合約 `.txt` 檔案。
2. 系統將這些條文餵入分析工具。

---

### 🧠 系統處理流程（分為 5 階段）

#### 🧼 階段 1：前處理（清理、語言判斷、分句切割）
- `core/clean_text.py`：清理特殊符號與空行
- `core/lang_detect.py`：判斷中英文
- `core/split_text.py`：將條文切成一條一條送入分析

#### 🧠 階段 2：條文篩選與初步過濾
- `risk_analyzer.py` 的：
  - `is_contextual_sentence()`：排除標題、定義等非條款句
  - `lacks_high_risk_combinations()`：檢查關鍵字組合，排除低風險句

#### 🤖 階段 3：呼叫 GPT 模型分析風險
- `risk_analyzer.py` → `gpt_analyze()` / `analyze_clause()`
- 使用提示語：`prompt_template_zh.txt`
- 模型：GPT-4 或 GPT-4o
- 輸出格式：`{"clause", "risk_level", "type", "reason", "highlight"}`

#### 🧪 階段 4：測試驗證（內部使用）
- 標準測資：`tests/test_risk_cases.json`
- 測試程式：`tests/test_risk_cases_runner.py`

#### 📊 階段 5：顯示結果（報表 / 可視化）
- `report_template.html` 顯示彩色標示條文
- 來自 `outputs/xxx.json` 檔案
- 使用者可檢視「風險類型與說明」

---

### 🧩 資源對照表（模組 → 功能）

| 功能                         | 模組 / 檔案                    |
|----------------------------|-----------------------------|
| 條文前處理                  | `core/clean_text.py`        |
| 語言判斷                    | `core/lang_detect.py`       |
| 條文切句                    | `core/split_text.py`        |
| 條文分析主邏輯              | `core/risk_analyzer.py`     |
| GPT 提示語                  | `prompts/prompt_template_zh.txt` |
| 測試資料與驗證機制          | `tests/test_risk_cases.json`, `test_risk_cases_runner.py` |
| 視覺化結果報告              | `report_template.html`      |

---

請你協助判斷以下條文是否屬於「須注意」的合約條款。

⚠️ 請特別注意：以下範例不只是格式參考，而是用來引導你「學習其中的分類邏輯」。你的任務是觀察範例中有哪些語句特徵會被判為風險，並據此判斷下方條文是否具有類似風險。請不要僅模仿格式，而應真正理解其風險依據。

判斷標準如下：
- 僅當條文對某一方施加了明確的不公平條件、過度義務、限制權利，或存在潛在法律爭議時，才視為「須注意」。
- 其他屬於常規描述、背景說明、常見資訊者，請標記為「一般資訊」。

請避免將以下情況標示為須注意：
- 常見的雙方責任義務描述，如「雙方應配合...」、「應善意履行...」
- 單純的法律遵循條款，如「應依據某法令執行...」
- 不含不對等條件或單方限制的付款、聯絡資訊、履約方式說明

⚠️ 以下為常見的「須注意」條款情境，請特別小心判斷：
- 條文中出現「一方有權修改條款，且不需通知對方」
- 條文表示「解除合約需對方書面同意」
- 條文中「乙方授權甲方無償使用資料於商業或行銷用途」

範例：
條文：「本契約雙方應善意協商處理合約未盡事宜。」
輸出：
{
  "clause": "本契約雙方應善意協商處理合約未盡事宜。",
  "risk_level": "一般資訊",
  "type": "常規義務",
  "reason": "為常見合作條款，未涉及單方限制或風險"
}

條文：「甲方有權隨時修改本服務條款，並不另行通知乙方。」
輸出：
{
  "clause": "甲方有權隨時修改本服務條款，並不另行通知乙方。",
  "risk_level": "須注意",
  "type": "單方變更條款",
  "reason": "條款允許甲方片面變更合約內容，且未保障乙方知情權"
}

條文：「乙方同意授權甲方無償使用其上傳資料用於行銷用途。」
輸出：
{
  "clause": "乙方同意授權甲方無償使用其上傳資料用於行銷用途。",
  "risk_level": "須注意",
  "type": "資訊使用授權",
  "reason": "授權條款用途過於廣泛，且無償，可能造成資訊控制不對等"
}

條文：「本合約不因乙方書面聲明即終止，仍需甲方書面同意。」
輸出：
{
  "clause": "本合約不因乙方書面聲明即終止，仍需甲方書面同意。",
  "risk_level": "須注意",
  "type": "終止限制條款",
  "reason": "條款限制乙方解除權利，需甲方書面同意，構成單方限制"
}

回傳格式請用 JSON，格式如下（不含任何其他說明文字）：
{
  "clause": "...",
  "risk_level": "須注意" / "一般資訊",
  "type": "...",
  "reason": "..."
}
