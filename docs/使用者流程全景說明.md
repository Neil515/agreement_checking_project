# 使用者流程全景說明（更新版，含分析模式與通知機制）

## 流程總覽：從使用者上傳到風險回傳與查詢

### ✅ 步驟一：使用者上傳合約文件

* 支援 PDF 或純文字格式。
* 系統會以 OCR（若為 PDF）與文字清洗方式抽出條文全文。

---

### ✅ 步驟二：條文切分與語言判斷

* 條文會被切成段落，每段視為初步的條文單位。
* **中文條文**：以兩個以上換行符號為段落分隔依據。
* **英文條文**：以句號、問號、驚嘆號斷句，搭配 `a. b. c.` 列點輔助判斷。
* 語言判斷會在切句前自動執行。

---

### ✅ 步驟三：條文風險分析（依分析模式）

使用者可於分析前選擇分析模式：

#### 🎛 模式一：快速分析模式（預設）

* 條文進入 `local_rule_filter(clause)` 函式
* 若包含高風險關鍵詞 → 標記為「需注意」
* 否則標示為「一般資訊」
* **不送 GPT，1\~2 秒內完成**

#### 🎛 模式二：精準分析模式（進階）

* 使用者可選擇：

  * ✅ 分析所有條款
  * ✅ 貼上欲分析條款（部分分析）
* 條文會逐句送入 GPT 模型分析，分類為：

  * 「一般資訊」：常見說明性條款
  * 「須注意」：不對等條款、模糊授權、爭議風險

---

### ✅ 步驟四：回傳與儲存分析結果

#### 若為快速模式：

* 所有條款立即顯示結果
* 無需等待背景處理

#### 若為精準模式：

* 分析任務會非同步執行，立即回傳 task\_id
* 結果儲存於 `outputs/pending_results/<task_id>.json`

---

### ✅ 步驟五：查詢分析結果與通知機制

* 使用者可前往查詢頁輸入 task\_id，查看分析狀態與結果
* 若任務尚未完成，頁面顯示「分析中」，自動輪詢更新
* 任務完成後：

  * 可選擇寄送 Email 通知
  * 點擊連結回到查詢頁，即可查看完整結果與理由

---

### 🔍 測試用途補充：黑白名單

* `data/risk_examples.json` 與 `data/whitelist_examples.json` 僅用於測試用例驗證
* 可執行 `test_risk_cases_runner_dual.py` 驗證實際分類與預期是否一致
* **不影響 GPT 真實判斷流程**

---

## 🔄 階段性策略與輸入來源規劃

### ✅ 第一階段（MVP）：主打 Chrome Extension

* 擷取網站內頁面條款，支援快速與精準模式切換
* 支援即時結果呈現與精準任務追蹤（非同步分析 + 查詢頁）

### ✅ 第二階段：加入 Word / 圖片檔上傳支援

* Word 檔：使用 `python-docx` 擷取內容
* 圖片：整合 Tesseract OCR 擷取條文後處理
* 前處理模組自動清洗版面雜訊

### ✅ 第三階段：開放 API 串接企業應用

* 提供 RESTful API，允許外部系統串接分析服務
* 回傳結果可為 JSON，供內部法務或合約管理系統整合

---

本流程設計致力於平衡「快速互動」與「精準判斷」，使用者可彈性選擇分析深度與等候方式，並透過查詢與通知機制維持完整風險掌握。
