# 使用者流程全景說明

## 流程總覽：從使用者上傳到風險分析回傳

### ✅ 步驟一：使用者上傳合約文件
- 支援 PDF 或純文字格式。
- 系統會以 OCR（若為 PDF）與文字清洗方式抽出條文全文。

---

### ✅ 步驟二：條文切分與語言判斷
- 條文會被切成段落，每段視為初步的條文單位。
- **中文條文**：以兩個以上換行符號切成段落作為主要依據，避免切得過碎。
- **英文條文**：以句號、問號、驚嘆號斷句，並納入 `a. b. c.` 這類列點補強。
- 語言判斷會在切句前先自動偵測條文語系。

---

### ✅ 步驟三：逐句風險分析
- 條文送入 `analyze_clause(clause, lang)` 分析函式。
- 其內部會根據語言呼叫 GPT，並依據內建 few-shot 範例學習分類：
  - "一般資訊"：常見說明性、標準合約義務
  - "須注意"：具不對等義務、模糊授權、可能產生糾紛之條文

- **注意：不會參考黑白名單判斷，只依賴 GPT 回傳。**

---

### ✅ 步驟四：儲存與回傳分析結果
- 每條分析後會產出：條文原文、風險等級、風險類型、標註理由。
- 結果儲存於 `outputs/full_agreement_analysis_debug.json`，供除錯與 UI 呈現。

---

### 🔍 測試用途補充：黑白名單
- `data/risk_examples.json`（高風險測資）與 `data/whitelist_examples.json`（一般資訊測資）僅作為測試使用。
- 執行 `test_risk_cases_runner_dual.py` 可比對實際分類與預期結果是否一致。
- 不會影響 GPT 真實判斷流程。
