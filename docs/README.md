## 專案簡介與進度整理（更新版）

本專案為「AI 合約風險條款分析工具」，目標是讓使用者能快速判斷條款中是否存在不對等、模糊授權或潛在糾紛風險，並以友善介面呈現。

---

## 🧭 系統定位

* 🎯 目標使用者：一般消費者、企業法務、內控單位
* 🧰 核心功能：

  * 條款偵測與分段
  * 風險初步分類（本地規則）
  * 精準風險分析（GPT API）
  * 即時 UI 呈現與分析模式切換

---

## 🛠 技術架構

* 前端：Chrome Extension 擷取條款 + 分析結果 UI 呈現
* 後端 API：Flask 架設 `/analyze` 端點
* 條文分析流程：

  1. OCR/純文字解析 ➜ 條文切段
  2. 語言判斷 ➜ 進入分析流程
  3. `mode=fast`：只用本地規則初篩，1 秒內回傳
  4. `mode=accurate`：送 GPT 分析，需 30 秒～數分鐘
* 任務回查與通知：分析結果儲存 JSON、提供查詢頁與 Email 通知

---

## ✅ 今日（2025-07-19）進度與重大結論

### 🎯 問題核心：

* 多條款送 GPT 導致等待時間過長（可達數分鐘～一小時）

### 🧠 解法核心：混合式分析架構

1. **快速分析模式**（預設）：

   * 本地規則判斷是否包含高風險關鍵詞
   * 未命中者立即標示為「一般資訊」
2. **精準分析模式**：

   * 使用者可選擇全部分析或貼上特定條款分析
   * 將任務丟入背景執行，完成後 Email 通知或回查頁查看
3. **查詢結果頁功能**：

   * 可輸入 task\_id 查詢分析結果狀態與內容
   * 尚未完成時顯示「分析中」與輪詢更新

### 📌 其他補充：

* 支援快取：條款如已分析過，自動重用結果
* UI 勾選功能：快速分析後可挑條款升級至 GPT 分析
* Email 通知：任務完成時寄出通知並附查詢連結

---

## 📋 下一步（見 `next_task_prompt.md`）

* 撰寫本地初篩函式 `local_rule_filter()` 並整合至分析主流程
* 前後端加入分析模式參數與 UI 選擇元件
* 支援「手動貼上條款」分析選項
* 加入非同步任務處理、分析結果快取與查詢頁建置

本專案將持續提升分析速度與彈性，邁向即時互動的專業條款審閱輔助工具。

# 2025-07-19 專案進度與內容整理（前端 UX 問題重點）

## 今日主要進度

### 1. 本地規則初篩功能
- 已完成 `core/risk_analyzer.py` 的 `local_rule_filter()`，支援中英文高風險關鍵字。
- 測試通過，快速分析可於毫秒級完成。

### 2. API 端點支援分析模式
- 已完成 `tools/api_server.py`，`/analyze` 端點支援 `mode` 參數（fast/accurate）。
- 測試通過，API 可正確分流至本地或 GPT 分析。

### 3. 前端 UI 分析模式切換
- `extension/content.js` 支援分析模式選擇（radio button）。
- 依需求調整為「所有模式都需點擊『開始分析』按鈕才會執行」。
- 按鈕背景色與條款淺藍色一致。

---

## 今日遇到的 UX 問題

1. **分析進度與完成狀態不明確**
   - 條文分析進度顯示已達 100%，但計時器未停止，且沒有明確「分析完成」提示。
2. **分析完成訊息顯示異常**
   - 關閉側欄再重新分析，計時器顯示 0 秒、進度為 0/0，卻出現「分析完成」訊息。
3. **分析完成訊息消失問題**
   - 「分析完成」的綠色訊息會自動消失，導致使用者容易錯過。
4. **切換分析模式後 UX 不直覺**
   - 切換分析模式時，按鈕雖然有出現，但沒有明確提示「請點擊按鈕開始分析」。
   - 切換模式後，所有進度、計時器、完成訊息應正確重置。
5. **條款淺藍色標記與進度同步問題**
   - 條款加上淺藍色時，進度顯示應同步更新。
6. **側欄關閉再開啟時，所有狀態需完全重置**
   - 關閉側欄時，計時器、進度、完成訊息、條款標記都要歸零，避免殘留錯誤狀態。
7. **所有分析模式都需點擊「開始分析」按鈕才會執行**
   - 不論快速或精準分析，都必須手動點擊按鈕才會開始分析。
   - 按鈕背景色需與條款淺藍色一致。

---

## 明日優先修正目標（UX Checklist）

- [ ] 分析進度達 100% 時，計時器立即停止，並明確顯示「分析完成」訊息（且訊息不會自動消失）。
- [ ] 分析完成訊息僅在分析條款數 > 0 且進度達 100% 時顯示。
- [ ] 關閉側欄時，所有狀態（計時器、進度、完成訊息、條款標記）都要正確重置。
- [ ] 切換分析模式時，進度、計時器、完成訊息、條款標記都要正確重置，並有明確提示。
- [ ] 條款淺藍色標記與進度同步，分析完成時狀態明確。
- [ ] 所有分析模式都需點擊「開始分析」按鈕才會執行，按鈕背景色與條款一致。
- [ ] 其他所有 UX 細節同步優化，確保不再有混亂或誤導。

---

> 明日請依照以上清單，逐項優化前端 UX，確保分析流程、狀態顯示、互動體驗完全正確、直覺。
